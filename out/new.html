<!doctype html>
<html lang="en-us">
  <head>
    <meta http-equiv="origin-trial" content="AiiqErPPIECW3smg0ZrmkBorbURWiOcf1tn4ge/XORQdLjo8OK+lM8WgWT8fDh905BmSi9he8uji55p/rnf1UgUAAABseyJvcmlnaW4iOiJodHRwczovL3NoYWRlcmVkaXRvci5rYXVzdC5lZHUuc2E6NDQzIiwiZmVhdHVyZSI6IldlYkdQVSIsImV4cGlyeSI6MTY2MzcxODM5OSwiaXNTdWJkb21haW4iOnRydWV9">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"/>
    <title>shader editor</title>
    <!-- Load Bootstrap and jquery -->
    <link rel="stylesheet" href="./assets/css/bootstrap.min.css"rel="stylesheet" >
    <script src="./assets/js/jquery.min.js" ></script>
    <script src="./assets/js/bootstrap.min.js" ></script>
    <link rel="stylesheet" type="text/css" href="./assets/css/jquery.dataTables.css" rel="stylesheet" >
    <script type="text/javascript" charset="utf8" src="./assets/js/jquery.dataTables.js" ></script>
    <!-- Default css, js file -->
    <link rel="stylesheet" type="text/css" href="./assets/css/main.css">
    <script type="text/javascript" charset="utf8" src="./assets/js/tool.js" ></script>
  </head>
  <body>
    <nav class="navbar navbar-default navbar-static-top" >
      <div class="container">
        <div class="navbar-header">
          <a class="navbar-brand" href="#">Shader Editor</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li><a href="/">Home</a></li>
                <li><a href="/about">About</a></li>
                <li><a href="/contact">Contact</a></li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                  <li><a id="welcome"></a></li>
                <li><a href="/browse">Browse</a></li>
                <li><a href="/new">New</a></li>
                <li><a id="signin" href="/signin">Sign In</a></li>
                </ul>
        </div>
      </div>
    </nav>

    <div class="container">
      <canvas class="emscripten" id="canvas" oncontextmenu="event.preventDefault()"></canvas>
      <div class="save_part" id="save_part" >
        <div class="form-group">
          <label for="save_name">Name of the shader</label>
          <input  type="text" class="form-control" id="save_name" >
        </div>
        <div class="form-group">
          <label for="save_select">Example select</label>
          <select class="form-control" id="save_select" >
            <option>Private</option>
            <option>Public</option>
          </select>
        </div>
        <button  class="btn btn-primary" onclick="save()">Save</button>
      </div>

      <div class="textbox">
        <div class="description" onclick="toggle('display_desc')">
          <span class="glyphicon glyphicon-menu-down" aria-hidden="true" >Input</span>
          <p class="display_desc" id="display_desc">
            uniform Time : f32; //shader playback time (in seconds) <br> 
            uniform Resolution : vec3&lt;f32&gt;; // viewport resolution <br> 
            uniform Mouse : vec4&lt;f32&gt;; // mouse pixel coords. xy: current, zw: click <br> 
            uniform Date1 : vec3&lt;i32&gt;; // year, month, day <br> 
            uniform Date2 : vec3&lt;i32&gt;; // hour, minute, second <br> 
            var texture1..4: texture_2d&lt;f32&gt;; // input textures <br> 
            var sampler_: sampler; // input sampler <br>
          </p>
        </div>
        <form action="/compile" method="post">
        <p name="shader_code">
          <textarea id="code" name="code" rows="25" cols="70">
@stage(fragment)
fn main(@builtin(position) position: vec4<f32>) -> @location(0) vec4<f32> {
  var uv: vec3<f32> =vec3<f32>(position.xyx/Resolution.xyx);
  var col:vec3<f32> =0.5f+vec3<f32> ( 0.5*cos(uv+Time+vec3<f32>(0.0,2.0,4.0)));
  return vec4<f32>(col, 1.0);
}
          </textarea>
    </p>
    <input type="hidden" name="texture1" id="texture1" value="admin_black.jpg">
    <input type="hidden" name="texture2" id="texture2" value="admin_black.jpg">
    <input type="hidden" name="texture3" id="texture3" value="admin_black.jpg">
    <input type="hidden" name="texture4" id="texture4" value="admin_black.jpg">
    <button type="submit" class="btn btn-primary"  >Compile</button>
        </form>
    
    <br>
    <br>
    <div class="texture_image">
    <button id="popover1" type="button" class="btn btn-default" title="Texture 1" trigger="click"
        data-container="body" data-toggle="popover1" data-placement="top" 
        >
      texture_1
    </button>
    <button id="popover2" type="button" class="btn btn-default" title="Texture 2"  
        data-container="body" data-toggle="popover2" data-placement="top" 
        >
        texture_2
    </button>
    <button id="popover3" type="button" class="btn btn-default" title="Texture 3"  
        data-container="body" data-toggle="popover3" data-placement="top" 
        >
        texture_3
    </button>
    <button id="popover4" type="button" class="btn btn-default" title="Texture 4"  
        data-container="body" data-toggle="popover4" data-placement="top" 
        >
        texture_4
    </button>
    <br>
    <img id="img1" src="texture/admin_black.jpg" class="img-thumbnail" width="84" height="84">
    <img id="img2" src="texture/admin_black.jpg" class="img-thumbnail" width="84" height="84">
    <img id="img3" src="texture/admin_black.jpg" class="img-thumbnail" width="84" height="84">
    <img id="img4" src="texture/admin_black.jpg" class="img-thumbnail" width="84" height="84">
    </div>
    <div class="upload_texture" id="upload_texture">
      <label for="image">Upload Texture</label>
      <input type="file" class="form-control-file" id="image" name="image" accpet=".jpg .png">
      <br>
      <button  class="btn btn-primary" onclick="upload()">Upload</button>
    </div>
    </div>
    </div>
    
    <script>
      $(function (){
          $("[data-toggle='popover1']").popover(
            { html: true,
              content: function() {
                return content("\"texture1\"","\"img1\"");
              }
            }
          );
          $("[data-toggle='popover2']").popover(
            { html: true,
              content: function() {
                return content("\"texture2\"","\"img2\"");
              }
            }
          );
          $("[data-toggle='popover3']").popover(
            { html: true,
              content: function() {
                return content("\"texture3\"","\"img3\"");
              }
            }
          );
          $("[data-toggle='popover4']").popover(
            { html: true,
              content: function() {
                return content("\"texture4\"","\"img4\"");
              }
            }
          );
      });
      var global_popover_code="{{texture_code}}"
      var whether_decode=true
      var Module;
      (async () => {
        Module = {
          preRun: [],
          postRun: [],
          print: (function() {
              return function(text) {
                  text = Array.prototype.slice.call(arguments).join(' ');
                  console.log(text);
              };
          })(),
          printErr: function(text) {
              text = Array.prototype.slice.call(arguments).join(' ');
              console.error(text);
          },
          canvas: (function() {
              var canvas = document.getElementById('canvas');
  
              return canvas;
          })(),
          setStatus: function(text) {
              console.log("status: " + text);
          },
          monitorRunDependencies: function(left) {
              // no run dependencies to log
          }
        };
        window.onerror = function() {
          console.log("onerror: " + event);
        };

      // Initialize the graphics adapter
      {
          const adapter = await navigator.gpu.requestAdapter();
          const device = await adapter.requestDevice();
          Module.preinitializedWebGPUDevice = device;
      }

      {
          const js = document.createElement('script');
          js.async = true;
          js.src = "new.js";
          document.body.appendChild(js);
      }
      })();


      if("{{username}}".length!=0)
      {
        document.getElementById("signin").href="/logout";
        document.getElementById("signin").innerText="Log Out";
        document.getElementById("welcome").href="/userprofile";
        document.getElementById("welcome").innerHTML="Welcome,<B><b>{{username}}</b></B>";
        document.getElementById("save_part").hidden=false;
        document.getElementById("upload_texture").hidden=false;
      }
      else
      {
        document.getElementById("save_part").hidden=true;
        document.getElementById("upload_texture").hidden=true;
      }

    </script>

  </body>
</html>